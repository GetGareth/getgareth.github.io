<!DOCTYPE html>
<html>
    
    
<head>

    <title>Some New Cool  Features</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link rel="shortcut icon" href="/getgareth.github.io/images/favicon.ico"/>
    <meta name="description" content="Gareth is an open source tool that let you validate your business goals automatically. We call this continuous validation." />
    <meta name="keywords" content="After continuous delivery, continuous validation, validate business goals, quality software, continuous deployment" />
    <!--[if lte IE 8]><script src="js/html5shiv.js"></script><![endif]-->

    <link rel="stylesheet" href="/getgareth.github.io/css/skel.css" />
    <link rel="stylesheet" href="/getgareth.github.io/css/style.css" />
    <link rel="stylesheet" href="/getgareth.github.io/css/style-xlarge.css" />

    <script src="/getgareth.github.io/js/jquery.min.js"></script>
    <script src="/getgareth.github.io/js/skel.min.js"></script>
    <script src="/getgareth.github.io/js/skel-layers.min.js"></script>
    <script src="/getgareth.github.io/js/init.js"></script>

    <script>

      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-69491019-1', 'auto');
      ga('send', 'pageview');

    </script>





</head>


	<body id="top">

        <!-- Header -->
<header id="header" class="skel-layers-fixed">
    <!--h1><a href="/getgareth.github.io/" class="site-title" >Gareth - Continuous Validation</a></h1-->
    <a href="/getgareth.github.io/"><img src="/getgareth.github.io/images/gareth-logo-big.png" class="logo" alt="Gareth Logo"></a>
    <nav id="nav">
        <ul>
            <li><a href="/getgareth.github.io/">Home</a></li>
            <li><a href="/getgareth.github.io/blog.html">Blog</a></li>
            <li><a href="https://github.com/craftsmenlabs/gareth-jvm#gareth">Docs</a></li>
            
                  
                    <li><a class="page-link" href="/getgareth.github.io/about/">About</a></li>
                  
            
                  
            
                  
            
                  
            
                  
            
                  
            
                  
            
                  
            
                  
            
          </ul>
    </nav>
  </header>


        <div class="wrapper style1">
    <article class="container">
      <div class="row">
        <div class="2u">
          <h2 class="page-heading">Posts:</h2>
          <ul class="post-list">
            
              <li>
                <span class="post-meta">Apr 12, 2016</span>
                <h5>
                  <a class="post-link" href="/getgareth.github.io/2016/04/12/some-new-cool-features.html">Some New Cool  Features</a>
                </h5>
              </li>
            
              <li>
                <span class="post-meta">Nov 16, 2015</span>
                <h5>
                  <a class="post-link" href="/getgareth.github.io/2015/11/16/Impact-mapping-and-continuous-validation.html">Impact Mapping And Continuous Validation</a>
                </h5>
              </li>
            
              <li>
                <span class="post-meta">Sep 16, 2015</span>
                <h5>
                  <a class="post-link" href="/getgareth.github.io/2015/09/16/Meet-Gareth.-He-is-seriously-unpleasant.html">Meet Gareth. He Is Seriously Unpleasant</a>
                </h5>
              </li>
            
              <li>
                <span class="post-meta">Sep 15, 2015</span>
                <h5>
                  <a class="post-link" href="/getgareth.github.io/2015/09/15/Gareth,-validating-your-business-goals.html">Gareth, Validating Your Business Goals</a>
                </h5>
              </li>
            
              <li>
                <span class="post-meta">Aug 15, 2015</span>
                <h5>
                  <a class="post-link" href="/getgareth.github.io/2015/08/15/After-continuous-integration-there-is-continuous-validation.html">After Continuous Integration There Is Continuous Validation</a>
                </h5>
              </li>
            
              <li>
                <span class="post-meta">Jul 14, 2015</span>
                <h5>
                  <a class="post-link" href="/getgareth.github.io/2015/07/14/How-assumptions-are-not-the-mother-of-all-f-ups.html">How Assumptions Are Not The Mother Of All F Ups</a>
                </h5>
              </li>
            
          </ul>
        </div>
        <div class="8u">
        <header class="major">
            <h2 class="post-title">Some New Cool  Features</h2>
                <p class="post-meta">Apr 12, 2016 • Jasper Sprengers -> <a href="http://twitter.com/jsprengers" target="_blank">@jsprengers</a></p>
        </header>

        <section class="post-content">
            <p>About regex, matching glue lines, dashboards and specification of duration: During the last <a href="http://twitter.com/codecentric_nl" target="_blank">@codecentric_nl</a> DevThursday we had the chance to add some great new functionality to the Gareth framework. From now on you will be able to use regular expressions (and re-use code for different experiments) and we made it easier and more flexible to specify the duration of experiments.</p>

<h1 id="matching-glue-lines-to-definition-methods">Matching glue lines to definition methods</h1>

<p>Your baselines, assumptions, success and failure definitions need to correspond to Java methods that do the actual work.
These Java methods reside in so-called definition classes that are known to Gareth through configuration, and the relevant methods are identified through the @Baseline, @Assume, @Time, @Success and @Failure annotations. In its simplest form, it looks like this:</p>

<p>Baseline: sale of anvils</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="vi">@Baseline</span><span class="p">(</span><span class="n">glueLine</span> <span class="o">=</span> <span class="s2">"sale of anvils"</span><span class="p">)</span>
 <span class="kp">public</span> <span class="n">void</span> <span class="n">getSaleOfAnvils</span><span class="p">()</span> <span class="p">{</span>
 <span class="no">System</span><span class="p">.</span><span class="nf">out</span><span class="p">.</span><span class="nf">println</span><span class="p">(</span><span class="s2">"Getting sale of anvils"</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>or with using the built-in Storage:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="vi">@Baseline</span><span class="p">(</span><span class="n">glueLine</span> <span class="o">=</span> <span class="s2">"sale of anvils"</span><span class="p">)</span>
<span class="kp">public</span> <span class="n">void</span> <span class="n">getSaleOfAnvils</span><span class="p">(</span><span class="n">final</span> <span class="no">Storage</span> <span class="n">storage</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">storage</span><span class="p">.</span><span class="nf">store</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">dbase</span><span class="p">.</span><span class="nf">getCurrentSalesOfProduct</span><span class="p">(</span><span class="s2">"anvil"</span><span class="p">));</span>
<span class="p">}</span></code></pre></figure>

<p>A shortcoming of this approach is that there is a strict one-to-one mapping between glue line and definition method. If you want to get the sale of hammers or screwdrivers in a different experiment you’d need to write new methods for each with probably very similar code. That hardly seems efficient. It would be much better if we could make our method configurable by adding the product as a parameter:
public void getSaleByProductCode(final String productCode){…}</p>

<p>Then we can indicate the configurable part in the glue line by means of a grouped regular expression, like so:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="vi">@Baseline</span><span class="p">(</span><span class="n">glueLine</span> <span class="o">=</span> <span class="s2">"sale of (.*?)"</span><span class="p">)</span>
<span class="kp">public</span> <span class="n">void</span> <span class="n">getSaleOfProductByCode</span><span class="p">(</span><span class="n">final</span> <span class="no">Storage</span> <span class="n">storage</span><span class="p">,</span><span class="n">final</span> <span class="no">String</span> <span class="n">productCode</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">storage</span><span class="p">.</span><span class="nf">store</span><span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">dbase</span><span class="p">.</span><span class="nf">getCurrentSalesOfProduct</span><span class="p">(</span><span class="n">productCode</span><span class="p">));</span>
<span class="p">}</span></code></pre></figure>

<p>Multiple groupings are allowed:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="vi">@Success</span><span class="p">(</span><span class="n">glueLine</span> <span class="o">=</span> <span class="s2">"order (</span><span class="se">\\</span><span class="s2">d{1,3}) (.*?) from (.*?)"</span><span class="p">)</span>
<span class="kp">public</span> <span class="n">void</span> <span class="n">sendTreats</span><span class="p">(</span><span class="n">int</span> <span class="n">amount</span><span class="p">,</span> <span class="no">String</span> <span class="n">treat</span><span class="p">,</span> <span class="no">String</span> <span class="n">supplier</span><span class="p">)</span> <span class="p">{</span>
	<span class="no">String</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="s2">"Enjoy the %d %s from %s"</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">treat</span><span class="p">,</span> <span class="n">supplier</span><span class="p">);</span>
<span class="p">}</span></code></pre></figure>

<p>And this lets you re-use the same Java code for very different glue lines:
Success: order 3 carrot cakes from local bakery
Success: order 5 iPhones from Amazon</p>

<p>It’s a powerful mechanism, but there are some rules to the game:</p>

<ul>
  <li>
    <p>The number of parenthesised regex groups must be exactly equal to the number of parameters in the method, ignoring the optional Storage parameter, which always comes first and is injected by Gareth when specified. The values are then extracted from the glueline and the definition method is called with these parameters:
“order 3 carrot cakes from local bakery” matches on 3, “carrot cakes” and “local bakery” and calls sendTreats(3,”carrot cakes”,”local bakery”)</p>
  </li>
  <li>
    <p>Permitted arguments types are String, Integer, Long, Double and their corresponding primitive types. Use of other types in definition methods will cause an error. Gareth must be able to convert parse the regex matches (always String) to a valid Java type.</p>
  </li>
</ul>

<h1 id="specifying-duration">Specifying duration</h1>
<p>The regex mechanism as described above is not available for the Time glue line, meaning that the @Time annotated definition method cannot be configured with arguments. However, you may leave it out entirely if your Time glue line follows the pattern of [number] [duration], where duration is one of second, minute, hour, day, week, month, year, or their corresponding plurals:
* Time: 48 hours
* Time: 3 weeks
* Time: 42 days
* Time: 1 month
* Time: 1 year</p>

<p>Note that month is always 30 days and year is 365 days. Running the experiment with 1 month duration on the 1st of February will check the assumption on the 3rd of March, ignoring leap years. If you want specific behaviour you can still write your own implementation:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="no">Time</span><span class="p">:</span> <span class="no">Tuesday</span> <span class="n">after</span> <span class="k">next</span> <span class="no">Easter</span>
<span class="vi">@Time</span><span class="p">(</span><span class="n">glueLine</span> <span class="o">=</span> <span class="s2">"Tuesday after next Easter"</span><span class="p">)</span>
<span class="kp">public</span> <span class="no">Duration</span> <span class="n">sampleTime</span><span class="p">()</span> <span class="p">{</span> <span class="p">.</span><span class="nf">.</span> <span class="p">}</span></code></pre></figure>

<hr />

<h1 id="dashboard">Dashboard</h1>
<p>Also we upgraded the dashboard quite a bit so there is a quick overview of running experiments and the amount of failing/succeeding:
<img src="/getgareth.github.io/images/blogpics/pie.png" class="fit image" /></p>

<p>And for a more detailed view of the experiments:
<img src="/getgareth.github.io/images/blogpics/list.png" class="fit image" /></p>

<p>Do you like it or do you need some help with setting Gareth up? Do you want to contribute in any way? Please let us know!</p>

        </section>
        </div>
      </div>
    </article>

</div>


        <!-- Footer -->
<footer id="footer">
    <div class="container">
        <div class="row double">
            <div class="6u">
                <div class="row collapse-at-2">
                    <div class="6u">
                        <ul class="alt">
                            <li><a href="http://www.gnu.org/licenses/gpl-2.0.en.html">GNU General Public License v2.0</a></li>
                        </ul>
                        <img src="/getgareth.github.io/images/gareth-logo.png" class="lean-image">
                    </div>
                </div>
            </div>
            <div class="6u">
                <h2>Contribute?</h2>
                <p>Are you interested? Please be our guest and try Gareth. Gareth is open source (GNU General Public License v2.0) so that we all can benefit. Do you want to contribute in any way? Please let us know! We are really looking forward to hearing from you.</p>
                <ul class="icons">
                    <li><a href="https://github.com/getgareth" class="icon fa-github"><span class="label">Github</span></a></li>
                </ul>
            </div>
        </div>
        <ul class="copyright">
            <li>Gareth is open source under the GNU General Public License v2.0</li>
        </ul>
    </div>
</footer>


    </body>

</html>
